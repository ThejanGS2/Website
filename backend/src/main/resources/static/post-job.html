<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post a Job | Nutzy Craft</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
    <!-- jobs.css might conflict or be redundant with dashboard styles, carefully integrating -->
    <script src="script.js" defer></script>
</head>

<body>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <a href="index.html" class="sidebar-logo">
                <img src="logo.jpg" alt="Logo" style="width: 40px; border-radius: 50%;">
                Nutzy Craft
            </a>

            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="client-dashboard.html" class="sidebar-link">
                        <i class="fa-solid fa-grid-2"></i> Dashboard
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-my-profile.html" class="sidebar-link">
                        <i class="fa-solid fa-user"></i> My Profile
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="post-job.html" class="sidebar-link active">
                        <i class="fa-solid fa-plus-circle"></i> Post a Job
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-my-jobs.html" class="sidebar-link">
                        <i class="fa-solid fa-briefcase"></i> My Jobs
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="find-freelancer.html" class="sidebar-link">
                        <i class="fa-solid fa-users"></i> Find Freelancers
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-messages.html" class="sidebar-link">
                        <i class="fa-solid fa-message"></i> Messages
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-settings.html" class="sidebar-link">
                        <i class="fa-solid fa-gear"></i> Settings
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-support.html" class="sidebar-link">
                        <i class="fa-solid fa-headset"></i> Support
                    </a>
                </li>
            </ul>

            <div class="sidebar-user">
                <img src="https://ui-avatars.com/api/?name=User&background=D4B69D&color=fff"
                    style="width: 40px; height: 40px; border-radius: 50%;">
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 0.9rem;">&nbsp;</div>
                    <div style="font-size: 0.8rem; color: #888;">&nbsp;</div>
                </div>
                <a href="logout.html" style="color: #888;"><i class="fa-solid fa-sign-out-alt"></i></a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Topbar -->
            <div class="dashboard-topbar">
                <button class="sidebar-toggle-btn"><i class="fa-solid fa-bars"></i></button>
                <div>
                    <h1 class="dashboard-title" style="font-size: 1.8rem;">Post a New Project</h1>
                    <p style="color: #666;">Connect with top-tier talent in minutes.</p>
                </div>
            </div>

            <div class="glass-card" style="padding: 40px; max-width: 900px; margin-bottom: 30px;">
                <form>
                    <div class="form-section">
                        <h3
                            style="font-size: 1.2rem; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                            1. Project Details</h3>
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label class="form-label"
                                style="display: block; font-weight: 700; margin-bottom: 8px;">Project Title</label>
                            <input type="text" id="job-title" class="form-input"
                                placeholder="e.g. Build a Nutzy Craft Website"
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-family: inherit;">
                        </div>
                        <div class="form-group">
                            <label class="form-label"
                                style="display: block; font-weight: 700; margin-bottom: 8px;">Category</label>
                            <select id="job-category" class="form-select"
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-family: inherit; background: white;">
                                <option>Web Development</option>
                                <option>Graphic Design</option>
                                <option>Content Writing</option>
                                <option>Digital Marketing</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section" style="margin-top: 30px;">
                        <h3
                            style="font-size: 1.2rem; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                            2. Description</h3>
                        <div class="form-group">
                            <label class="form-label"
                                style="display: block; font-weight: 700; margin-bottom: 8px;">Describe your
                                project</label>
                            <textarea id="job-description" class="form-textarea"
                                placeholder="Provide details about what you need..."
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; min-height: 150px; font-family: inherit; resize: vertical;"></textarea>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label class="form-label"
                                style="display: block; font-weight: 700; margin-bottom: 8px;">Attachments</label>
                            <div class="file-upload" id="drop-zone"
                                style="border: 2px dashed #ddd; padding: 30px; text-align: center; border-radius: 12px; cursor: pointer; transition: 0.3s;">
                                <i class="fa-solid fa-cloud-arrow-up"
                                    style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                                <p id="job-attachment-text">Drag & drop files or <span
                                        style="color: var(--primary); font-weight: 700;">Browse</span></p>
                                <input type="file" id="file-input" multiple style="display: none;">
                            </div>
                            <div id="file-list" style="margin-top: 15px; text-align: left;"></div>
                        </div>
                    </div>



                    <div class="form-section" style="margin-top: 30px;">
                        <h3
                            style="font-size: 1.2rem; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                            3. Budget & Timeline</h3>
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label class="form-label"
                                style="display: block; font-weight: 700; margin-bottom: 8px;">Estimated Budget
                                ($)</label>
                            <input type="number" id="job-budget" class="form-input" placeholder="500"
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-family: inherit;">
                        </div>
                        <div class="form-group">
                            <label class="form-label"
                                style="display: block; font-weight: 700; margin-bottom: 8px;">Project Duration</label>
                            <select id="job-duration" class="form-select"
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-family: inherit; background: white;">
                                <option>Less than 1 week</option>
                                <option>1 to 4 weeks</option>
                                <option>1 to 3 months</option>
                                <option>More than 3 months</option>
                            </select>
                        </div>
                    </div>

                    <div style="text-align: right; margin-top: 40px;">
                        <button type="button" class="btn btn-outline"
                            style="margin-right: 10px; padding: 10px 24px;">Save Draft</button>
                        <button type="button" id="post-job-btn" class="btn btn-primary" style="padding: 10px 24px;">Post
                            Project
                            Now</button>
                    </div>
                </form>
            </div>

            <script>
                document.getElementById('post-job-btn').addEventListener('click', async () => {
                    const title = document.getElementById('job-title').value;
                    const category = document.getElementById('job-category').value;
                    const description = document.getElementById('job-description').value;
                    const budget = document.getElementById('job-budget').value;
                    const duration = document.getElementById('job-duration').value;

                    const email = localStorage.getItem('loggedInEmail') || sessionStorage.getItem('loggedInEmail');

                    if (!title || !description || !budget) {
                        alert('Please fill in all required fields');
                        return;
                    }

                    if (!email) {
                        alert('You must be logged in to post a job');
                        window.location.href = 'login.html';
                        return;
                    }

                    const jobData = {
                        title,
                        description,
                        category,
                        budget: parseFloat(budget),
                        duration
                    };

                    try {
                        const response = await fetch(`/api/jobs?clientEmail=${encodeURIComponent(email)}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(jobData)
                        });

                        if (response.ok) {
                            alert('Job posted successfully!');
                            window.location.href = 'client-my-jobs.html';
                        } else {
                            alert('Failed to post job');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('An error occurred');
                    }
                });

                // File Upload Logic
                const dropZone = document.getElementById('drop-zone');
                const fileInput = document.getElementById('file-input');
                const fileList = document.getElementById('file-list');
                let selectedFiles = [];

                // Handle Browse Click
                dropZone.addEventListener('click', () => fileInput.click());

                // Handle File Selection
                fileInput.addEventListener('change', (e) => {
                    handleFiles(e.target.files);
                });

                // Drag & Drop Events
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false);
                });

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, highlight, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, unhighlight, false);
                });

                function highlight(e) {
                    dropZone.style.borderColor = 'var(--primary)';
                    dropZone.style.backgroundColor = 'rgba(var(--primary-rgb), 0.05)';
                }

                function unhighlight(e) {
                    dropZone.style.borderColor = '#ddd';
                    dropZone.style.backgroundColor = 'transparent';
                }

                dropZone.addEventListener('drop', (e) => {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    handleFiles(files);
                });

                function handleFiles(files) {
                    const newFiles = Array.from(files);
                    selectedFiles = [...selectedFiles, ...newFiles];
                    updateFileList();
                }

                function updateFileList() {
                    fileList.innerHTML = '';
                    selectedFiles.forEach((file, index) => {
                        const fileItem = document.createElement('div');
                        fileItem.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 6px; margin-bottom: 5px; font-size: 0.9rem;';

                        fileItem.innerHTML = `
                            <span><i class="fa-solid fa-file" style="color: #666; margin-right: 8px;"></i>${file.name}</span>
                            <button type="button" onclick="removeFile(${index})" style="background: none; border: none; color: #ff4757; cursor: pointer;"><i class="fa-solid fa-trash"></i></button>
                        `;
                        fileList.appendChild(fileItem);
                    });
                }

                // Expose removeFile to global scope (since it's inline onclick)
                window.removeFile = function (index) {
                    selectedFiles.splice(index, 1);
                    updateFileList();
                };
            </script>
    </div>

    </main>
    </div>

</body>

</html>