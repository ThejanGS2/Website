<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sayur Thejan - Full Stack Developer | Nutzy Craft</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="profile.css">
    <script src="script.js" defer></script>
</head>

<body>
    <nav class="navbar glass-panel">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <img src="logo.jpg" alt="Nutzy Craft Logo" class="logo-img">
                Nutzy Craft
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="find-jobs.html">Browse Jobs</a>
                <a href="how-it-works.html">How it Works</a>
            </div>
            <div class="nav-actions">
                <a href="login.html" class="btn btn-outline" style="padding: 8px 18px;">Login</a>
            </div>
            <button class="mobile-menu-btn"><i class="fa-solid fa-bars"></i></button>
        </div>
    </nav>

    <div class="container profile-container" id="profile-container">
        <!-- 1. Profile Header -->
        <div class="glass-card profile-header-card">
            <div class="profile-banner"></div>
            <div class="profile-header-content">
                <img src="https://ui-avatars.com/api/?name=User&background=random&color=fff&size=200" alt="User"
                    class="profile-avatar-large" id="profile-avatar">
                <div class="profile-info">
                    <div class="profile-name-row">
                        <h1 class="profile-name" id="profile-name">Loading...</h1>
                        <div class="badge-verified"><i class="fa-solid fa-check"></i></div>
                    </div>
                    <p class="profile-title" id="profile-title">...</p>
                    <div class="profile-meta">
                        <div class="meta-item"><i class="fa-solid fa-location-dot"></i> Remote</div>
                        <div class="status-badge"><span
                                style="width: 8px; height: 8px; background: #2e7d32; border-radius: 50%; display: inline-block; margin-right: 5px;"></span>
                            Available</div>
                    </div>
                    <div style="margin-top: 15px; display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 1.5rem; font-weight: 800; color: var(--primary);">$<span
                                id="profile-rate">0</span><span
                                style="font-size: 1rem; color: var(--text-muted); font-weight: 600;">/hr</span></span>
                        <div style="display: flex; color: #ffc107;" id="profile-rating-stars">
                            <!-- Stars injected via JS -->
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="btn btn-primary" style="padding: 12px 30px;">Hire Me</button>
                </div>
            </div>
        </div>

        <div class="profile-grid-layout">
            <!-- Left Column: Main Content -->
            <div class="profile-main">

                <!-- 2. About Me -->
                <div class="glass-card profile-section">
                    <h3 class="section-title"><i class="fa-solid fa-user"></i> About Me</h3>
                    <p style="color: var(--text-muted); line-height: 1.8;" id="profile-bio">
                        Loading bio...
                    </p>
                </div>

                <!-- 4. Portfolio -->
                <div class="glass-card profile-section">
                    <h3 class="section-title"><i class="fa-solid fa-briefcase"></i> Portfolio</h3>
                    <p style="color: #666;">No portfolio items to display yet.</p>
                </div>
            </div>

            <!-- Right Column: Sidebar -->
            <div class="profile-sidebar">

                <!-- 3. Skills -->
                <div class="glass-card profile-section">
                    <h3 class="section-title" style="font-size: 1.2rem;">Skills</h3>
                    <div class="skills-tags" id="profile-skills">
                        <span style="color: #888; font-size: 0.9rem;">No skills listed.</span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container footer-container">
            <!-- About Us -->
            <div class="footer-col">
                <h3 class="footer-heading">ABOUT US</h3>
                <div class="footer-line"></div>
                <p class="footer-text">
                    Nutzy Craft stands at the frontier of digital innovation.
                </p>
            </div>
        </div>
        <div class="container">
            <div class="footer-bottom">
                <p>Copyright Â© 2025 All rights reserved by Nutzy Craft</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const email = urlParams.get('email'); // Allow loading by email too

            let apiUrl = null;
            if (id) {
                apiUrl = `/api/freelancers/${id}`;
            } else if (email) {
                apiUrl = `/api/freelancers/me?email=${email}`; // Reusing existing endpoint if applicable, or logic
            }

            if (!apiUrl) {
                document.getElementById('profile-name').textContent = "Freelancer Not Found";
                document.getElementById('profile-title').textContent = "Profile not specified";
                return;
            }

            try {
                const res = await fetch(apiUrl);
                if (res.ok) {
                    const freelancer = await res.json();

                    // Populate Header
                    document.getElementById('profile-name').textContent = freelancer.user?.fullName || "Unknown";
                    document.getElementById('profile-title').textContent = freelancer.title || "Freelancer";
                    document.getElementById('profile-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(freelancer.user?.fullName || 'User')}&background=random&size=200`;
                    document.getElementById('profile-rate').textContent = freelancer.hourlyRate || '0';
                    document.getElementById('profile-bio').innerHTML = (freelancer.bio || "No bio available.").replace(/\n/g, '<br>');

                    // Rating
                    const rating = freelancer.rating || 0;
                    const starsContainer = document.getElementById('profile-rating-stars');
                    let starsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= rating) starsHtml += '<i class="fa-solid fa-star"></i>';
                        else if (i - 0.5 <= rating) starsHtml += '<i class="fa-solid fa-star-half-stroke"></i>';
                        else starsHtml += '<i class="fa-regular fa-star"></i>';
                    }
                    starsHtml += `<span style="color: var(--text-muted); margin-left: 5px; font-weight: 600;">(${rating.toFixed(1)})</span>`;
                    starsContainer.innerHTML = starsHtml;

                    // Skills
                    const skillsContainer = document.getElementById('profile-skills');
                    if (freelancer.skills && freelancer.skills.length > 0) {
                        skillsContainer.innerHTML = freelancer.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('');
                    } else {
                        skillsContainer.innerHTML = '<span style="color: #888; font-size: 0.9rem;">No skills listed.</span>';
                    }

                } else {
                    document.getElementById('profile-name').textContent = "Error Loading Profile";
                }
            } catch (e) {
                console.error(e);
                document.getElementById('profile-name').textContent = "Error";
            }
        });
    </script>
</body>

</html>